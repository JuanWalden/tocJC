<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <title>TOC Tracker - Mis Victorias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-600: #4B5563;
            --gray-800: #1F2937;
            --gray-900: #111827;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            color: var(--gray-900);
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 40px rgba(0,0,0,0.15);
        }

        header {
            background: var(--primary);
            color: white;
            padding: 24px 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 20px;
            background: var(--gray-50);
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .stat-card.success .stat-value {
            color: var(--success);
        }

        .stat-card.warning .stat-value {
            color: var(--warning);
        }

        .percentage {
            font-size: 16px;
            color: var(--gray-600);
            margin-top: 4px;
        }

        .action-section {
            padding: 20px;
        }

        .question {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 20px;
            text-align: center;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-victory {
            background: var(--success);
            color: white;
        }

        .btn-victory:hover {
            background: #059669;
        }

        .btn-compulsion {
            background: var(--danger);
            color: white;
        }

        .btn-compulsion:hover {
            background: #DC2626;
        }

        .encouragement {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .encouragement-text {
            font-size: 16px;
            font-weight: 500;
            line-height: 1.5;
        }

        .history-section {
            padding: 0 20px 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .history-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .clear-btn {
            background: none;
            border: none;
            color: var(--danger);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 12px;
        }

        .history-item {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .history-item.victory {
            border-color: var(--success);
            background: #F0FDF4;
        }

        .history-item.compulsion {
            border-color: var(--danger);
            background: #FEF2F2;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .history-item.victory .history-icon {
            background: var(--success);
        }

        .history-item.compulsion .history-icon {
            background: var(--danger);
        }

        .history-content {
            flex: 1;
        }

        .history-type {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .history-item.victory .history-type {
            color: var(--success);
        }

        .history-item.compulsion .history-type {
            color: var(--danger);
        }

        .history-time {
            font-size: 13px;
            color: var(--gray-600);
        }

        .streak-banner {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            padding: 16px 20px;
            text-align: center;
            margin: 0 20px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .streak-banner strong {
            font-size: 24px;
            display: block;
            margin-bottom: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-600);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            animation: popup 0.3s ease-out;
        }

        @keyframes popup {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .celebration-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .celebration-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
        }

        .celebration-subtext {
            font-size: 16px;
            color: var(--gray-600);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            padding: 0 20px;
        }

        .filter-tab {
            padding: 8px 16px;
            border: 2px solid var(--gray-300);
            background: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        @media (max-width: 380px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¯ TOC Tracker</h1>
            <p>Cada victoria debilita al TOC</p>
            <p style="margin-top: 8px; font-size: 13px; opacity: 0.85;">Centro Rol Huelva Â· Juan Orta</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card success">
                <div class="stat-value" id="victoryCount">0</div>
                <div class="stat-label">âœ“ Victorias</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-value" id="compulsionCount">0</div>
                <div class="stat-label">âš  Compulsiones</div>
            </div>
            <div class="stat-card" style="grid-column: span 2;">
                <div class="stat-value" id="percentageValue">--%</div>
                <div class="stat-label">Tasa de resistencia</div>
            </div>
        </div>

        <div id="streakBanner" style="display: none;"></div>

        <div class="action-section">
            <div class="question">Â¿ApareciÃ³ una duda TOC?</div>
            
            <div class="button-group">
                <button class="btn btn-victory" onclick="recordVictory()">
                    âœ“ ResistÃ­
                </button>
                <button class="btn btn-compulsion" onclick="recordCompulsion()">
                    âœ— Hice compulsiÃ³n
                </button>
            </div>

            <div class="encouragement" id="encouragement">
                <div class="encouragement-text" id="encouragementText">
                    Cada vez que resistes una compulsiÃ³n, estÃ¡s reentrenando tu cerebro. Â¡TÃº decides!
                </div>
            </div>
        </div>

        <div class="filter-tabs">
            <button class="filter-tab active" onclick="filterHistory('all')">Todos</button>
            <button class="filter-tab" onclick="filterHistory('today')">Hoy</button>
            <button class="filter-tab" onclick="filterHistory('week')">Esta semana</button>
        </div>

        <div class="history-section">
            <div class="history-header">
                <h2 class="history-title">Historial</h2>
                <button class="clear-btn" onclick="clearHistory()">Limpiar</button>
            </div>
            <div id="historyList"></div>
        </div>
    </div>

    <script>
        // Datos
        let entries = JSON.parse(localStorage.getItem('tocEntries')) || [];
        let currentFilter = 'all';

        // Mensajes de Ã¡nimo
        const victoryMessages = [
            "Â¡Excelente! Acabas de debilitar al TOC un poco mÃ¡s.",
            "Â¡Victoria! Tu cerebro estÃ¡ aprendiendo que puede tolerar la duda.",
            "Â¡FantÃ¡stico! Cada resistencia es un paso hacia la libertad.",
            "Â¡Bien hecho! Le has enseÃ±ado a tu mente que no necesita certeza.",
            "Â¡IncreÃ­ble! Esto es exactamente lo que fortalece tu recuperaciÃ³n.",
            "Â¡SÃ­! Toleraste la incertidumbre. Eso es valentÃ­a real.",
            "Â¡Genial! Cada vez serÃ¡ un poco mÃ¡s fÃ¡cil.",
            "Â¡Poderoso! EstÃ¡s construyendo nuevas conexiones neuronales.",
            "Â¡Bravo! Tu TOC acaba de perder una batalla importante.",
            "Â¡Perfecto! EstÃ¡s practicando exactamente lo que necesitas."
        ];

        const compulsionMessages = [
            "EstÃ¡ bien. La prÃ³xima duda es una nueva oportunidad para resistir.",
            "Sin problema. Cada intento cuenta. La prÃ³xima vez puedes elegir diferente.",
            "No pasa nada. Anota esto como informaciÃ³n y sigue adelante.",
            "Recuerda: una compulsiÃ³n no borra tus victorias anteriores.",
            "EstÃ¡ bien tropezar. Lo importante es levantarse para el prÃ³ximo round.",
            "Esto es parte del proceso. Cada duda es una oportunidad de aprender.",
            "No te castigues. Usa esto como motivaciÃ³n para la prÃ³xima.",
            "El progreso no es lineal. MantÃ©n el foco en el objetivo."
        ];

        const encouragementMessages = [
            "El TOC te dice que DEBES actuar. La verdad: PUEDES elegir.",
            "Cada compulsiÃ³n entrena tu TOC. Cada resistencia lo debilita.",
            "La ansiedad bajarÃ¡ sola. Las compulsiones solo le enseÃ±an a tu cerebro a tener mÃ¡s miedo.",
            "No necesitas certeza para estar seguro. Esa es la trampa del TOC.",
            "Tu trabajo no es eliminar dudas, sino aprender a vivir con ellas.",
            "El malestar es temporal. El aprendizaje es permanente.",
            "Tolerar la duda hoy = menos poder del TOC maÃ±ana.",
            "Cada 'no' a una compulsiÃ³n es un 'sÃ­' a tu libertad."
        ];

        // Funciones principales
        function recordVictory() {
            const entry = {
                type: 'victory',
                timestamp: new Date().toISOString()
            };
            entries.unshift(entry);
            saveData();
            showCelebration();
            updateUI();
            rotateEncouragement();
        }

        function recordCompulsion() {
            const entry = {
                type: 'compulsion',
                timestamp: new Date().toISOString()
            };
            entries.unshift(entry);
            saveData();
            updateUI();
            showCompulsionMessage();
            rotateEncouragement();
        }

        function saveData() {
            localStorage.setItem('tocEntries', JSON.stringify(entries));
        }

        function updateUI() {
            updateStats();
            updateStreak();
            renderHistory();
        }

        function updateStats() {
            const victories = entries.filter(e => e.type === 'victory').length;
            const compulsions = entries.filter(e => e.type === 'compulsion').length;
            const total = victories + compulsions;
            const percentage = total > 0 ? Math.round((victories / total) * 100) : 0;

            document.getElementById('victoryCount').textContent = victories;
            document.getElementById('compulsionCount').textContent = compulsions;
            document.getElementById('percentageValue').textContent = percentage + '%';
        }

        function updateStreak() {
            let streak = 0;
            for (let entry of entries) {
                if (entry.type === 'victory') {
                    streak++;
                } else {
                    break;
                }
            }

            const banner = document.getElementById('streakBanner');
            if (streak >= 3) {
                banner.innerHTML = `<strong>ðŸ”¥ ${streak} victorias seguidas</strong><div>Â¡EstÃ¡s en racha!</div>`;
                banner.style.display = 'block';
            } else {
                banner.style.display = 'none';
            }
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            const filtered = getFilteredEntries();

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p>AÃºn no hay registros</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = filtered.map(entry => {
                const date = new Date(entry.timestamp);
                const timeStr = formatTime(date);
                const isVictory = entry.type === 'victory';

                return `
                    <div class="history-item ${entry.type}">
                        <div class="history-icon">
                            ${isVictory ? 'âœ“' : 'âœ—'}
                        </div>
                        <div class="history-content">
                            <div class="history-type">
                                ${isVictory ? 'ResistÃ­ la compulsiÃ³n' : 'Hice compulsiÃ³n'}
                            </div>
                            <div class="history-time">${timeStr}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getFilteredEntries() {
            const now = new Date();
            
            switch(currentFilter) {
                case 'today':
                    const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    return entries.filter(e => new Date(e.timestamp) >= todayStart);
                
                case 'week':
                    const weekStart = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return entries.filter(e => new Date(e.timestamp) >= weekStart);
                
                default:
                    return entries;
            }
        }

        function filterHistory(filter) {
            currentFilter = filter;
            
            // Update tab styles
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderHistory();
        }

        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Ahora mismo';
            if (minutes < 60) return `Hace ${minutes} min`;
            if (hours < 24) return `Hace ${hours}h`;
            if (days < 7) return `Hace ${days} dÃ­as`;
            
            return date.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
        }

        function showCelebration() {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.innerHTML = `
                <div class="celebration-icon">ðŸŽ‰</div>
                <div class="celebration-text">${getRandomMessage(victoryMessages)}</div>
                <div class="celebration-subtext">Sigue asÃ­</div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(celebration);

            setTimeout(() => {
                overlay.remove();
                celebration.remove();
            }, 2000);
        }

        function showCompulsionMessage() {
            const encouragement = document.getElementById('encouragement');
            const text = document.getElementById('encouragementText');
            
            text.textContent = getRandomMessage(compulsionMessages);
            encouragement.style.background = 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)';
            
            setTimeout(() => {
                encouragement.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }, 3000);
        }

        function rotateEncouragement() {
            const text = document.getElementById('encouragementText');
            setTimeout(() => {
                text.textContent = getRandomMessage(encouragementMessages);
            }, 3000);
        }

        function getRandomMessage(messages) {
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function clearHistory() {
            if (confirm('Â¿Seguro que quieres borrar todo el historial? Esto no se puede deshacer.')) {
                entries = [];
                saveData();
                updateUI();
            }
        }

        // Inicializar
        updateUI();
        rotateEncouragement();

        // Cambiar mensaje cada 10 segundos
        setInterval(rotateEncouragement, 10000);
    </script>
</body>
</html>
